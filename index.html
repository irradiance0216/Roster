<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manning Pro: Position Tracker</title>
    <style>
        :root { --primary: #2563eb; --work: #3b82f6; --break: #e2e8f0; --text: #1e293b; }
        body { font-family: 'Inter', system-ui, sans-serif; background: #f1f5f9; color: var(--text); padding: 20px; }
        section { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 1.5rem; }
        
        .grid-inputs { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; align-items: end; }
        input { padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; width: 100%; box-sizing: border-box; }
        label { display: block; font-size: 11px; font-weight: 700; margin-bottom: 5px; text-transform: uppercase; color: #64748b; }
        
        .chart-container { overflow-x: auto; background: white; padding: 20px; border-radius: 12px; border: 1px solid #e2e8f0; }
        .schedule-grid { display: grid; grid-template-columns: 140px repeat(96, 40px); border-collapse: collapse; }
        .cell { height: 35px; border: 1px solid #f1f5f9; display: flex; align-items: center; justify-content: center; font-size: 10px; text-align: center; overflow: hidden; white-space: nowrap; }
        .time-header { position: sticky; top: 0; background: white; font-weight: bold; z-index: 10; border-bottom: 2px solid #cbd5e1; }
        .worker-name { position: sticky; left: 0; background: #f8fafc; font-weight: bold; border-right: 2px solid #cbd5e1; z-index: 5; justify-content: flex-start; padding-left: 10px; }
        
        .status-work { background: var(--work); color: white; font-weight: bold; }
        .status-break { background: var(--break); color: #94a3b8; }
        .status-off { background: #f8fafc; opacity: 0.4; }
        
        button { padding: 12px 20px; cursor: pointer; background: var(--primary); color: white; border: none; border-radius: 6px; font-weight: 700; width: 100%; margin: 10px 0; }
        .list-box { margin-top: 10px; font-size: 13px; max-height: 150px; overflow-y: auto; border: 1px solid #eee; padding: 10px; border-radius: 6px; }
    </style>
</head>
<body>

    <section>
        <h2>1. Personnel</h2>
        <div class="grid-inputs">
            <div><label>Name</label><input type="text" id="sName" placeholder="Staff Name"></div>
            <div><label>In</label><input type="time" id="sStart" value="09:00"></div>
            <div><label>Out</label><input type="time" id="sEnd" value="17:00"></div>
            <button onclick="addStaff()">+ Add Staff</button>
        </div>
        <div id="staffList" class="list-box"></div>
    </section>

    <section>
        <h2>2. Positions</h2>
        <div class="grid-inputs">
            <div><label>Position Name</label><input type="text" id="pName" placeholder="e.g. Desk"></div>
            <div><label>Start</label><input type="time" id="pStart"></div>
            <div><label>End</label><input type="time" id="pEnd"></div>
            <button onclick="addPosition()">+ Add Position</button>
        </div>
        <div id="pList" class="list-box"></div>
    </section>

    <button onclick="runScheduler()">üîÑ GENERATE DETAILED ROTATION</button>

    <div class="chart-container" id="chartOutput"></div>

    <script>
        let staff = JSON.parse(localStorage.getItem('staff_v9')) || [];
        let positions = JSON.parse(localStorage.getItem('positions_v9')) || [];
        
        const t2m = t => { const [h, m] = t.split(':').map(Number); return h * 60 + m; };
        const m2t = m => `${Math.floor(m/60).toString().padStart(2,'0')}:${(m%60).toString().padStart(2,'0')}`;

        function addStaff() {
            const name = document.getElementById('sName').value;
            if(!name) return;
            staff.push({ name, start: t2m(document.getElementById('sStart').value), end: t2m(document.getElementById('sEnd').value) });
            updateUI();
        }

        function addPosition() {
            const name = document.getElementById('pName').value;
            if(!name) return;
            positions.push({ name, start: t2m(document.getElementById('pStart').value), end: t2m(document.getElementById('pEnd').value) });
            updateUI();
        }

        function updateUI() {
            localStorage.setItem('staff_v9', JSON.stringify(staff));
            localStorage.setItem('positions_v9', JSON.stringify(positions));
            document.getElementById('staffList').innerHTML = staff.map((s,i)=>`<div>üë§ ${s.name} <button onclick="staff.splice(${i},1);updateUI()" style="color:red;border:none;background:none;cursor:pointer;">[x]</button></div>`).join('');
            document.getElementById('pList').innerHTML = positions.map((p,i)=>`<div>üìç ${p.name} <button onclick="positions.splice(${i},1);updateUI()" style="color:red;border:none;background:none;cursor:pointer;">[x]</button></div>`).join('');
        }

        function runScheduler() {
            const container = document.getElementById('chartOutput');
            container.innerHTML = '';
            const grid = document.createElement('div');
            grid.className = 'schedule-grid';

            // Generate Time Headers
            grid.appendChild(Object.assign(document.createElement('div'), { className: 'cell time-header', innerText: 'Staff' }));
            for(let m=0; m<1440; m+=15) {
                const h = grid.appendChild(document.createElement('div'));
                h.className = 'cell time-header';
                h.innerText = m % 60 === 0 ? m2t(m) : m%60;
            }

            // Init Staff Schedule
            staff.forEach(s => { 
                s.schedule = new Array(96).fill({ status: 'off', label: '' }); 
                s.totalMinutes = 0; 
            });

            // Iterate 15-min slots
            for (let i = 0; i < 96; i++) {
                const currentTime = i * 15;
                let activePos = positions.filter(p => currentTime >= p.start && currentTime < p.end);
                let onDuty = staff.filter(s => currentTime >= s.start && currentTime < s.end);

                // Default on-duty to break
                onDuty.forEach(s => {
                    s.schedule[i] = { status: 'break', label: '‚Äî' };
                });

                // Assign positions based on lowest workload
                activePos.forEach(pos => {
                    let available = onDuty.filter(s => s.schedule[i].status === 'break');
                    if (available.length > 0) {
                        available.sort((a, b) => a.totalMinutes - b.totalMinutes);
                        let worker = available[0];
                        worker.schedule[i] = { status: 'work', label: pos.name };
                        worker.totalMinutes += 15;
                    }
                });
            }

            // Render
            staff.forEach(s => {
                const nameDiv = document.createElement('div');
                nameDiv.className = 'cell worker-name';
                nameDiv.innerText = s.name;
                grid.appendChild(nameDiv);

                s.schedule.forEach(slot => {
                    const c = document.createElement('div');
                    c.className = `cell status-${slot.status}`;
                    c.innerText = slot.label;
                    grid.appendChild(c);
                });
            });

            container.appendChild(grid);
        }
        updateUI();
    </script>
</body>
</html>
