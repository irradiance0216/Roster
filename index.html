<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manning Pro: Final Edition</title>
    <style>
        :root { --primary: #2563eb; --accent: #f59e0b; --text: #1e293b; --success: #10b981; --danger: #ef4444; }
        body { font-family: 'Inter', system-ui, sans-serif; background: #f8fafc; color: var(--text); max-width: 1100px; margin: 2rem auto; padding: 1rem; }
        section { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); margin-bottom: 1.5rem; }
        .grid { display: grid; grid-template-columns: 2fr 1fr 1fr 1.5fr auto; gap: 15px; align-items: end; margin-bottom: 1rem; }
        input, select { padding: 10px; border: 1px solid #cbd5e1; border-radius: 6px; width: 100%; box-sizing: border-box; }
        label { display: block; font-size: 11px; font-weight: 700; color: #64748b; margin-bottom: 4px; text-transform: uppercase; }
        
        /* Intensity Slider */
        .slider-container { display: flex; align-items: center; gap: 10px; background: #f1f5f9; padding: 5px 10px; border-radius: 6px; }
        
        button { padding: 10px 15px; cursor: pointer; background: var(--primary); color: white; border: none; border-radius: 6px; font-weight: 600; }
        .list-item { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #f1f5f9; align-items: center; font-size: 14px; }
        
        /* Timeline Rendering */
        .timeline-box { overflow-x: auto; padding-top: 10px; }
        .worker-row { display: flex; align-items: center; margin-bottom: 20px; }
        .worker-info { width: 150px; font-size: 13px; flex-shrink: 0; }
        .track { position: relative; flex-grow: 1; height: 50px; background: #e2e8f0; border-radius: 8px; border: 1px solid #cbd5e1; min-width: 800px; }
        .block { position: absolute; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 10px; font-weight: bold; color: white; border-right: 1px solid rgba(255,255,255,0.2); }
        .scale { display: flex; margin-left: 150px; padding-top: 8px; font-size: 11px; color: #64748b; min-width: 800px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 15px; background: white; border-radius: 8px; overflow: hidden; }
        th, td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; }
        .warn { color: var(--danger); font-weight: bold; }
    </style>
</head>
<body>

    <header style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
        <div>
            <h1 style="margin:0; color: var(--primary);">Manning Pro <small style="font-weight:400; color:#64748b;">v4.0</small></h1>
            <p style="margin:0; font-size: 14px;">Smart Distribution & Load Balancing</p>
        </div>
        <button onclick="saveAll()" style="background: #64748b;">ðŸ’¾ Save Setup</button>
    </header>

    <section>
        <label>1. Workforce Availability</label>
        <div class="grid" style="grid-template-columns: 2fr 1fr 1fr auto;">
            <div><label>Staff Name</label><input type="text" id="sName" placeholder="e.g. Worker A"></div>
            <div><label>Shift Start</label><input type="time" id="sStart" value="09:00"></div>
            <div><label>Shift End</label><input type="time" id="sEnd" value="17:00"></div>
            <button onclick="addStaff()" style="background: var(--success);">+ Add Staff</button>
        </div>
        <div id="staffList"></div>
    </section>

    <section>
        <label>2. Position Requirements</label>
        <div class="grid">
            <div><label>Position</label><input type="text" id="pName" placeholder="e.g. Counter"></div>
            <div><label>Start Time</label><input type="time" id="pStart"></div>
            <div><label>End Time</label><input type="time" id="pEnd"></div>
            <div>
                <label>Intensity (Multiplier)</label>
                <div class="slider-container">
                    <input type="range" id="pWeight" min="0.5" max="3" step="0.1" value="1" oninput="wLabel.innerText = this.value">
                    <span id="wLabel" style="font-weight:bold; min-width:25px;">1</span>x
                </div>
            </div>
            <button onclick="addPosition()">+ Add</button>
        </div>
        <div id="pList"></div>
    </section>

    <button onclick="runScheduler()" style="width: 100%; padding: 20px; font-size: 18px; margin-bottom: 2rem; background: var(--text); border-radius: 8px;">ðŸš€ Generate Balanced Schedule</button>

    <section id="resultSection" style="display:none;">
        <h3>Visual Roster</h3>
        <div class="timeline-box" id="timeline"></div>
        <div class="scale" id="rScale"></div>
        
        <h3 style="margin-top: 40px;">Fairness Analysis</h3>
        <div id="statsTable"></div>
    </section>

    <script>
        let staff = JSON.parse(localStorage.getItem('staff')) || [];
        let positions = JSON.parse(localStorage.getItem('positions')) || [];
        window.onload = () => { renderStaff(); renderPositions(); };

        const timeToDec = t => { const [h, m] = t.split(':').map(Number); return h + (m / 60); };
        const decToTime = n => { 
            const h = Math.floor(n); 
            const m = Math.round((n - h) * 60); 
            return `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}`; 
        };

        function addStaff() {
            const name = document.getElementById('sName').value;
            const start = timeToDec(document.getElementById('sStart').value);
            const end = timeToDec(document.getElementById('sEnd').value);
            if (name && start < end) {
                staff.push({ name, start, end });
                renderStaff();
            }
        }

        function addPosition() {
            const name = document.getElementById('pName').value;
            const start = timeToDec(document.getElementById('pStart').value);
            const end = timeToDec(document.getElementById('pEnd').value);
            const weight = parseFloat(document.getElementById('pWeight').value);
            if (name && start < end) {
                positions.push({ name, start, end, dur: end - start, weight });
                positions.sort((a,b) => a.start - b.start);
                renderPositions();
            }
        }

        function renderStaff() { 
            document.getElementById('staffList').innerHTML = staff.map((s,i) => `
                <div class="list-item"><span><b>${s.name}</b> (${decToTime(s.start)} - ${decToTime(s.end)})</span>
                <button onclick="staff.splice(${i},1);renderStaff()" style="background:var(--danger)">Ã—</button></div>`).join(''); 
        }

        function renderPositions() { 
            document.getElementById('pList').innerHTML = positions.map((p,i) => `
                <div class="list-item"><span><b>${p.name}</b> [${p.weight}x] (${decToTime(p.start)} - ${decToTime(p.end)})</span>
                <button onclick="positions.splice(${i},1);renderPositions()" style="background:var(--danger)">Ã—</button></div>`).join(''); 
        }

        function saveAll() { 
            localStorage.setItem('staff', JSON.stringify(staff)); 
            localStorage.setItem('positions', JSON.stringify(positions)); 
            alert("Configuration saved to browser memory!"); 
        }

        function getColor(weight) {
            if(weight <= 1) return '#3b82f6'; // Standard
            if(weight <= 1.8) return '#f59e0b'; // Moderate
            return '#ef4444'; // Heavy
        }

        function runScheduler() {
            if (!staff.length || !positions.length) return alert("Please add both staff and positions!");

            const container = document.getElementById('timeline');
            const scale = document.getElementById('rScale');
            container.innerHTML = ''; scale.innerHTML = '';
            
            const dayStart = Math.min(...staff.map(s => s.start), ...positions.map(p => p.start));
            const dayEnd = Math.max(...staff.map(s => s.end), ...positions.map(p => p.end));
            const span = dayEnd - dayStart;

            // Reset worker loads
            staff.forEach(s => { s.tasks = []; s.busyUntil = s.start; s.fatigue = 0; });

            // Balanced Algorithm: Assign to available person with LOWEST fatigue
            positions.forEach(pos => {
                let availableStaff = staff.filter(s => 
                    s.start <= pos.start && 
                    s.end >= pos.end && 
                    s.busyUntil <= pos.start
                );

                if (availableStaff.length > 0) {
                    availableStaff.sort((a, b) => a.fatigue - b.fatigue);
                    let worker = availableStaff[0];
                    worker.tasks.push(pos);
                    worker.busyUntil = pos.end;
                    worker.fatigue += (pos.dur * pos.weight);
                }
            });

            // Draw Timeline
            staff.forEach(s => {
                const row = document.createElement('div');
                row.className = 'worker-row';
                let blocks = s.tasks.map(t => {
                    const left = ((t.start - dayStart) / span) * 100;
                    const width = (t.dur / span) * 100;
                    return `<div class="block" style="left:${left}%; width:${width}%; background:${getColor(t.weight)}">
                                ${t.name}<br>${t.weight}x
                            </div>`;
                }).join('');

                row.innerHTML = `<div class="worker-info"><b>${s.name}</b><br><small>${decToTime(s.start)}-${decToTime(s.end)}</small></div>
                                 <div class="track">${blocks}</div>`;
                container.appendChild(row);
            });

            // Draw Scale
            for (let h = Math.floor(dayStart); h <= Math.ceil(dayEnd); h++) {
                scale.innerHTML += `<div style="flex:1; border-left:1px solid #cbd5e1; padding-left:4px;">${h}:00</div>`;
            }

            // Render Fatigue Table
            let statsHtml = `<table><tr><th>Name</th><th>Work Hours</th><th>Fatigue Score</th><th>Break Time</th><th>Status</th></tr>`;
            staff.forEach(s => {
                const totalWork = s.tasks.reduce((sum, t) => sum + t.dur, 0);
                const brk = (s.end - s.start) - totalWork;
                statsHtml += `<tr>
                    <td>${s.name}</td>
                    <td>${totalWork.toFixed(1)}h</td>
                    <td><b>${s.fatigue.toFixed(1)}</b></td>
                    <td>${brk.toFixed(2)}h</td>
                    <td>${brk < 1.5 ? '<span class="warn">Low Break</span>' : 'âœ… OK'}</td>
                </tr>`;
            });
            document.getElementById('statsTable').innerHTML = statsHtml + `</table>`;
            document.getElementById('resultSection').style.display = 'block';
        }
    </script>
</body>
</html>
